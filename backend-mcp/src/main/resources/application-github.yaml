server:
  port: ${GITHUB_MCP_HTTP_PORT:${SERVER_PORT:8080}}

spring:
  autoconfigure:
    exclude: []
  datasource:
    url: ${GITHUB_MCP_DB_URL:jdbc:postgresql://localhost:5432/ai_advent}
    username: ${GITHUB_MCP_DB_USER:ai_advent}
    password: ${GITHUB_MCP_DB_PASSWORD:ai_advent}
    driver-class-name: org.postgresql.Driver
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  liquibase:
    change-log: classpath:db/changelog/github/db.changelog-master.yaml
    contexts: github-rag
  ai:
    mcp:
      server:
        enabled: true
        stdio: false
        protocol: STREAMABLE
        name: github-mcp
        version: 0.1.0
        type: SYNC
        annotation-scanner:
          enabled: false
        instructions: |
          GitHub MCP предоставляет инструменты для чтения дерева репозитория и содержимого файлов.
          Убедитесь, что Personal Access Token имеет права чтения репозитория (pull requests, contents, checks).
        capabilities:
          tool: true
          resource: false
          prompt: false
          completion: false
      streamable-http:
        mcp-endpoint: /mcp
        keep-alive-interval: 30s
    openai:
      enabled: true
      api-key: ${OPENAI_API_KEY:demo-openai-key}
      base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1}
      embedding:
        options:
          model: ${GITHUB_RAG_EMBEDDING_MODEL:text-embedding-3-small}
          dimensions: ${GITHUB_RAG_EMBEDDING_DIMENSIONS:1536}

github:
  backend:
    base-url: ${GITHUB_API_BASE_URL:https://api.github.com}
    personal-access-token: ${GITHUB_PAT:}
    connect-timeout: ${GITHUB_CONNECT_TIMEOUT:PT15S}
    read-timeout: ${GITHUB_READ_TIMEOUT:PT45S}
    tree-cache-ttl: ${GITHUB_TREE_CACHE_TTL:PT2M}
    file-cache-ttl: ${GITHUB_FILE_CACHE_TTL:PT2M}
    tree-max-depth: ${GITHUB_TREE_MAX_DEPTH:4}
    tree-max-entries: ${GITHUB_TREE_MAX_ENTRIES:500}
    file-max-size-bytes: ${GITHUB_FILE_MAX_SIZE_BYTES:524288}
    user-agent: ${GITHUB_USER_AGENT:AI Advent GitHub MCP/0.1}
  rag:
    namespace-prefix: ${GITHUB_RAG_NAMESPACE_PREFIX:repo}
    max-concurrency: ${GITHUB_RAG_MAX_CONCURRENCY:2}
    chunk:
      max-bytes: ${GITHUB_RAG_MAX_CHUNK_BYTES:2048}
      max-lines: ${GITHUB_RAG_MAX_CHUNK_LINES:160}
    retry:
      max-attempts: ${GITHUB_RAG_MAX_ATTEMPTS:5}
      initial-backoff: ${GITHUB_RAG_INITIAL_BACKOFF:PT15S}
    embedding:
      model: ${GITHUB_RAG_EMBEDDING_MODEL:text-embedding-3-small}
      dimensions: ${GITHUB_RAG_EMBEDDING_DIMENSIONS:1536}
    rerank:
      top-n: ${GITHUB_RAG_RERANK_TOP_N:8}
      score-weight: ${GITHUB_RAG_RERANK_SCORE_WEIGHT:0.8}
      line-span-weight: ${GITHUB_RAG_RERANK_LINE_SPAN_WEIGHT:0.2}
      max-snippet-lines: ${GITHUB_RAG_MAX_SNIPPET_LINES:8}
