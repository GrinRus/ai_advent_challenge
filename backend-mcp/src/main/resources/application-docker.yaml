server:
  port: ${DOCKER_MCP_HTTP_PORT:${SERVER_PORT:8080}}

spring:
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration
      - org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiAudioSpeechAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiAudioTranscriptionAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiChatAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiEmbeddingAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiImageAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiModerationAutoConfiguration
      - org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration
  ai:
    mcp:
      server:
        enabled: true
        stdio: false
        protocol: STREAMABLE
        name: docker-runner-mcp
        version: 0.1.0
        type: SYNC
        annotation-scanner:
          enabled: false
        instructions: |
          Docker Runner MCP запускает Gradle-задачи внутри изолированного контейнера.
          Перед запуском передайте корректные workspaceId, tasks, а также при необходимости projectPath и переменные окружения.
        capabilities:
          tool: true
          resource: false
          prompt: false
          completion: false
      streamable-http:
        mcp-endpoint: /mcp
        keep-alive-interval: 30s

docker:
  runner:
    docker-binary: ${DOCKER_RUNNER_DOCKER_BINARY:docker}
    image: ${DOCKER_RUNNER_IMAGE:aiadvent/mcp-gradle-runner:latest}
    workspace-root: ${DOCKER_RUNNER_WORKSPACE_ROOT:/var/tmp/aiadvent/mcp-workspaces}
    workspace-volume: ${DOCKER_RUNNER_WORKSPACE_VOLUME:}
    gradle-cache-path: ${DOCKER_RUNNER_GRADLE_CACHE_PATH:/var/tmp/aiadvent/gradle-cache}
    gradle-cache-volume: ${DOCKER_RUNNER_GRADLE_CACHE_VOLUME:}
    timeout: ${DOCKER_RUNNER_TIMEOUT:PT15M}
    max-log-bytes: ${DOCKER_RUNNER_MAX_LOG_BYTES:524288}
    enable-network: ${DOCKER_RUNNER_ENABLE_NETWORK:false}
    volumes-from-self: ${DOCKER_RUNNER_VOLUMES_FROM_SELF:true}
    default-args: ${DOCKER_RUNNER_DEFAULT_ARGS:}
    default-env:
      GRADLE_USER_HOME: ${DOCKER_RUNNER_GRADLE_USER_HOME:/gradle-cache}
      TESTCONTAINERS_HOST_OVERRIDE: ${DOCKER_RUNNER_TESTCONTAINERS_HOST_OVERRIDE:}
    memory-limit-gb: ${DOCKER_RUNNER_MEMORY_LIMIT_GB:0}
    cpu-limit: ${DOCKER_RUNNER_CPU_LIMIT:0}
